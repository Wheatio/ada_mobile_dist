import{Q as L}from"./QSelect.9981794d.js";import{Q as R}from"./QInput.2669ef99.js";import{Q as V}from"./QCheckbox.6bb5f927.js";import{b as $,a as D,Q as v}from"./QItem.b5da8b2b.js";import{Q as b}from"./QMenu.9c0ae8ce.js";import{v as U,O as k,g as f,R as O,l as q,k as I,t as M,h as B,_ as P,o as d,I as u,w as i,a as A,d as m,c as j,M as T,F,e as C,Q as E,J as S,K as w}from"./index.0835d3cd.js";import{Q as z}from"./QPage.aea7938e.js";import{a as x}from"./awardAPI.223c603e.js";import"./use-key-composition.c69b71c6.js";import"./use-dark.e535c535.js";import"./focus-manager.8e1b27e8.js";import"./format.1c072718.js";import"./QDialog.88cddf69.js";import"./use-prevent-scroll.f779b089.js";import"./use-timeout.275153e9.js";import"./use-tick.a35a1ec4.js";import"./focusout.fbc56a61.js";import"./rtl.b51694b1.js";import"./selection.d17b1b0c.js";const K={position:{type:String,default:"bottom-right",validator:t=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(t)},offset:{type:Array,validator:t=>t.length===2},expand:Boolean};function J(){const{props:t,proxy:{$q:e}}=M(),o=U(O,k);if(o===k)return console.error("QPageSticky needs to be child of QLayout"),k;const c=f(()=>{const a=t.position;return{top:a.indexOf("top")>-1,right:a.indexOf("right")>-1,bottom:a.indexOf("bottom")>-1,left:a.indexOf("left")>-1,vertical:a==="top"||a==="bottom",horizontal:a==="left"||a==="right"}}),s=f(()=>o.header.offset),l=f(()=>o.right.offset),r=f(()=>o.footer.offset),n=f(()=>o.left.offset),p=f(()=>{let a=0,h=0;const g=c.value,_=e.lang.rtl===!0?-1:1;g.top===!0&&s.value!==0?h=`${s.value}px`:g.bottom===!0&&r.value!==0&&(h=`${-r.value}px`),g.left===!0&&n.value!==0?a=`${_*n.value}px`:g.right===!0&&l.value!==0&&(a=`${-_*l.value}px`);const y={transform:`translate(${a}, ${h})`};return t.offset&&(y.margin=`${t.offset[1]}px ${t.offset[0]}px`),g.vertical===!0?(n.value!==0&&(y[e.lang.rtl===!0?"right":"left"]=`${n.value}px`),l.value!==0&&(y[e.lang.rtl===!0?"left":"right"]=`${l.value}px`)):g.horizontal===!0&&(s.value!==0&&(y.top=`${s.value}px`),r.value!==0&&(y.bottom=`${r.value}px`)),y}),N=f(()=>`q-page-sticky row flex-center fixed-${t.position} q-page-sticky--${t.expand===!0?"expand":"shrink"}`);function Q(a){const h=q(a.default);return I("div",{class:N.value,style:p.value},t.expand===!0?h:[I("div",h)])}return{$layout:o,getStickyContent:Q}}var X=B({name:"QPageSticky",props:K,setup(t,{slots:e}){const{getStickyContent:o}=J();return()=>o(e)}});const Y={props:["moduleType","category"],data(){return{fullClassLists:[],loadingClassLists:!0,classNameOptions:[],selectedClass:null,selectedStudentsArray:[],description:null,countOfRewardsAndSanctions:[],userRewardsAndSanctions:[],loading:!0}},methods:{award(){this.selectedStudentsArray.forEach((t,e)=>{t&&(console.log("awarding thing to",this.selectedStudentList[0].students[e]),this.awardCommendation(this.selectedStudentList[0].students[e].misId))}),this.$router.push("/award")},getAllStudents(){this.loadingClassLists=!0,x.getStudentsInAllClasses(this.processStudentsInClasses)},processStudentsInClasses(t){this.fullClassLists=t,console.log("class lists: ",this.fullClassLists);const e=t.map(o=>({label:o.code,value:o.misId}));this.classNameOptions=e,this.selectedClass=this.classNameOptions[0].value,this.setUpCheckBoxArray(),this.mergeRewardsIntoStudentArray(),console.log("merged class lists: ",this.fullClassLists)},getUserRewardsandSanctions(){this.loading=!0,x.getUserRewardsAndSanctions(this.processUserRewardsandSanctions,this.userId)},processUserRewardsandSanctions(t){this.userRewardsAndSanctions=t,this.countRewardsAndSanctions(),this.loading=!1},countRewardsAndSanctions(){const t=this.userRewardsAndSanctions,e={};t.forEach(c=>{const{mis_id:s,firstname:l,lastname:r,year:n,moduleType_id:p}=c;switch(e[s]||(e[s]={mis_id:s,firstName:l,lastName:r,year:n,Commendations:0,Distinctions:0,Copies:0,MinorConcerns:0,SeriousConcerns:0}),p){case 4:e[s].Commendations++;break;case 6:e[s].Distinctions++;break;case 7:e[s].Copies++;break;case 11:e[s].MinorConcerns++;break;case 12:e[s].SeriousConcerns++;break}});const o=Object.values(e);o.sort((c,s)=>c.year-s.year),console.log(o),this.countOfRewardsAndSanctions=o},mergeRewardsIntoStudentArray(){console.log("merging commendations");for(let t of this.fullClassLists){console.log("trying class ",t.id);for(let e of t.students){let o=this.countOfRewardsAndSanctions.find(c=>c.mis_id===e.misId);o&&(console.log("found one. ",e.misId,o),e.Commendations=o.Commendations,e.Copies=o.Copies,e.Distinctions=o.Distinctions,e.MinorConcerns=o.MinorConcerns,e.SeriousConcerns=o.SeriousConcerns)}}},setUpCheckBoxArray(){this.selectedStudentsArray=[];const t=[];for(let e=0;e<this.selectedStudentList[0].students.length;e++)t.push(!1);this.selectedStudentsArray=t,this.loadingClassLists=!1},awardCommendation(t){const e={date:new Date,categoryId:Number(this.category),moduleTypeId:Number(this.moduleType),teacherId:this.userDetails.isamsId,description:this.description,subjectId:this.currentSubject};console.log("awarding commendation: to ",t,e),x.postAward(this.awardSuccess,this.awardFail,t,e)},awardSuccess(t){this.$q.notify({position:"center",message:"successfully awarded",color:"green"}),this.selectedStudent=null,this.photo=null,this.description=null},awardFail(){this.$q.notify({position:"center",color:"red",message:"awarding failed, check your connection to the internet"})}},watch:{selectedClass(){this.setUpCheckBoxArray()}},computed:{userClasses(){return this.$store.getters["user/getUserClasses"]},selectedStudentList(){return this.fullClassLists.filter(e=>e.misId===this.selectedClass)},disableDueToValidation(){return!(this.selectedStudentsArray.includes(!0)&&this.description)},userSubjects(){return this.$store.getters["user/getUserClasses"]},userId(){return this.$store.getters["user/userId"]},userDetails(){return this.$store.getters["user/getUserDetails"]},awardCategories(){return this.$store.getters["awards/getAwardCategories"]},currentModule(){return this.awardCategories?this.awardCategories.find(e=>Number(e.id)===Number(this.moduleType)):[]},currentCategory(){return this.currentModule?this.currentModule.categories.find(e=>Number(e.id)===Number(this.category)):[]},currentSubject(){return Number(this.category)===33||Number(this.category)===38?63:Number(this.category)===35||Number(this.category)===39?62:this.userClasses[0].id}},mounted(){this.getAllStudents(),this.getUserRewardsandSanctions()}},G={class:"flex-auto q-my-lg",style:{height:"65vh","overflow-y":"auto"}},H={class:"q-gutter-xs"};function W(t,e,o,c,s,l){return d(),u(z,null,{default:i(()=>[A("div",null,[m(L,{class:"q-ma-sm",options:s.classNameOptions,outlined:"",standout:"","map-options":"","emit-value":"",modelValue:s.selectedClass,"onUpdate:modelValue":e[0]||(e[0]=r=>s.selectedClass=r)},null,8,["options","modelValue"]),m(R,{class:"q-mx-xl",outlined:"",label:"description (required)",modelValue:s.description,"onUpdate:modelValue":e[1]||(e[1]=r=>s.description=r),rules:[r=>!!r||"description is required"]},null,8,["modelValue","rules"])]),A("div",G,[s.loadingClassLists?C("",!0):(d(),u($,{key:0,dense:""},{default:i(()=>[(d(!0),j(F,null,T(l.selectedStudentList[0].students,(r,n)=>(d(),u(D,{key:r.id},{default:i(()=>[m(v,{side:""},{default:i(()=>[m(V,{modelValue:s.selectedStudentsArray[n],"onUpdate:modelValue":p=>s.selectedStudentsArray[n]=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),m(v,{clickable:"",onClick:p=>s.selectedStudentsArray[n]=!s.selectedStudentsArray[n]},{default:i(()=>[S(w(r.fullName),1)]),_:2},1032,["onClick"]),m(v,{side:""},{default:i(()=>[A("div",H,[r.Commendations>0?(d(),u(b,{key:0,dense:"",icon:"fas fa-star",color:"green"},{default:i(()=>[S(w(r.Commendations),1)]),_:2},1024)):C("",!0),r.Distinctions>0?(d(),u(b,{key:1,dense:"",icon:"fas fa-award",color:"purple"},{default:i(()=>[S(w(r.Distinctions),1)]),_:2},1024)):C("",!0),r.Copies>0?(d(),u(b,{key:2,dense:"",icon:"fas fa-jedi",color:"amber-5"},{default:i(()=>[S(w(r.Copies),1)]),_:2},1024)):C("",!0),r.MinorConcerns>0?(d(),u(b,{key:3,dense:"",icon:"fas fa-exclamation-triangle",color:"red"},{default:i(()=>[S(w(r.MinorConcerns),1)]),_:2},1024)):C("",!0),r.SeriousConcerns>0?(d(),u(b,{key:4,dense:"",icon:"fas fa-star-exclamation",color:"red"},{default:i(()=>[S(w(r.SeriousConcerns),1)]),_:2},1024)):C("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),m(X,{position:"bottom-right",class:"q-pa-md"},{default:i(()=>[m(E,{rounded:"",class:"q-pa-md",style:{width:"40vw"},color:"primary",label:"Award",onClick:l.award,disable:l.disableDueToValidation},null,8,["onClick","disable"])]),_:1})]),_:1})}var Ce=P(Y,[["render",W]]);export{Ce as default};
