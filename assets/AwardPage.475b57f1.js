import{Q as T,a as R}from"./QSelect.d90f3d55.js";import{j as a,g as O,aq as U,ar as K,r as z,U as G,y as H,z as W,n as Y,k as J,q as X,ad as Z,v as A,x as $,p as ee,K as te,ag as oe,_ as re,o as p,$ as y,w as c,c as w,d as u,a1 as v,a2 as S,a0 as b,a as g,Q as k,a4 as se,a5 as ie,R as ne}from"./index.3e2de913.js";import{Q as ae}from"./QImg.8dd30388.js";import{Q as le}from"./QInput.c5637279.js";import{a as ue}from"./focus-manager.8e1b27e8.js";import{k as ce,j as de}from"./QItem.316c8aa3.js";import{Q as E,a as _}from"./QCard.24ca4f51.js";import{g as pe,c as me,a as q,Q as fe,b as j}from"./awardAPI.de8d18fc.js";import"./use-dark.c0da1af0.js";import"./format.feb17ea1.js";const he=[a("circle",{cx:"12.5",cy:"12.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"0s",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"12.5",cy:"52.5",r:"12.5","fill-opacity":".5"},[a("animate",{attributeName:"fill-opacity",begin:"100ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"52.5",cy:"12.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"300ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"52.5",cy:"52.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"600ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"92.5",cy:"12.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"800ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"92.5",cy:"52.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"400ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"12.5",cy:"92.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"700ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"52.5",cy:"92.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"500ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),a("circle",{cx:"92.5",cy:"92.5",r:"12.5"},[a("animate",{attributeName:"fill-opacity",begin:"200ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})])];var ge=O({name:"QSpinnerGrid",props:U,setup(e){const{cSize:t,classes:i}=K(e);return()=>a("svg",{class:i.value,fill:"currentColor",width:t.value,height:t.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg"},he)}}),ye=O({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:t,emit:i}){const m=X(),o=z(null);let n=0;const r=[];function P(s){const h=typeof s=="boolean"?s:e.noErrorFocus!==!0,C=++n,L=(l,d)=>{i("validation"+(l===!0?"Success":"Error"),d)},Q=l=>{const d=l.validate();return typeof d.then=="function"?d.then(f=>({valid:f,comp:l}),f=>({valid:!1,comp:l,err:f})):Promise.resolve({valid:d,comp:l})};return(e.greedy===!0?Promise.all(r.map(Q)).then(l=>l.filter(d=>d.valid!==!0)):r.reduce((l,d)=>l.then(()=>Q(d).then(f=>{if(f.valid===!1)return Promise.reject(f)})),Promise.resolve()).catch(l=>[l])).then(l=>{if(l===void 0||l.length===0)return C===n&&L(!0),!0;if(C===n){const{comp:d,err:f}=l[0];if(f!==void 0&&console.error(f),L(!1,d),h===!0){const F=l.find(({comp:I})=>typeof I.focus=="function"&&Z(I.$)===!1);F!==void 0&&F.comp.focus()}}return!1})}function N(){n++,r.forEach(s=>{typeof s.resetValidation=="function"&&s.resetValidation()})}function D(s){s!==void 0&&A(s);const h=n+1;P().then(C=>{h===n&&C===!0&&(e.onSubmit!==void 0?i("submit",s):s!==void 0&&s.target!==void 0&&typeof s.target.submit=="function"&&s.target.submit())})}function M(s){s!==void 0&&A(s),i("reset"),$(()=>{N(),e.autofocus===!0&&e.noResetFocus!==!0&&x()})}function x(){ue(()=>{if(o.value===null)return;const s=o.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(o.value.querySelectorAll("[tabindex]"),h=>h.tabIndex>-1);s!=null&&s.focus({preventScroll:!0})})}G(ee,{bindComponent(s){r.push(s)},unbindComponent(s){const h=r.indexOf(s);h>-1&&r.splice(h,1)}});let V=!1;return H(()=>{V=!0}),W(()=>{V===!0&&e.autofocus===!0&&x()}),Y(()=>{e.autofocus===!0&&x()}),Object.assign(m.proxy,{validate:P,resetValidation:N,submit:D,reset:M,focus:x,getValidationComponents:()=>r}),()=>a("form",{class:"q-form",ref:o,onSubmit:D,onReset:M},J(t.default))}});function B(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var be=te({name:"close-popup",beforeMount(e,{value:t}){const i={depth:B(t),handler(m){i.depth!==0&&setTimeout(()=>{const o=pe(e);o!==void 0&&me(o,m,i.depth)})},handlerKey(m){oe(m,13)===!0&&i.handler(m)}};e.__qclosepopup=i,e.addEventListener("click",i.handler),e.addEventListener("keyup",i.handlerKey)},updated(e,{value:t,oldValue:i}){t!==i&&(e.__qclosepopup.depth=B(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}}),ve={methods:{$errorFn(e){e?(console.log("ErrorFn says: ",e.response.data.exception[0].message),e.response.data.exception[0].message.includes("Department is configured as required")&&console.log("Department is configured as required")):console.error("no response received from server")}}};const xe={mixins:[ve],data(){return{selectedStudent:"",description:null,studentOptions:null,reasonOptions:["Great effort",""],fullStudentOptions:[],studentList:["Adam","Becky","Charles","Dog","Esme"],photo:null,photoLoading:!1,openDescriptionPopup:!1,quickDescriptions:[{id:11,descriptions:["Late","Poor standard of uniform","Incomplete Prep","Prep not done","Disruptive behaviour","Not bringing necessary materials to the lesson"]}],studentsLoading:!0,copyPopup:!1}},computed:{disableDueToValidation(){return!(this.selectedStudent&&this.description)},userClasses(){return this.$store.getters["user/getUserClasses"]},userId(){return this.$store.getters["user/userId"]},userDetails(){return this.$store.getters["user/getUserDetails"]},awardCategories(){return this.$store.getters["awards/getAwardCategories"]},currentModule(){return this.awardCategories?this.awardCategories.find(t=>Number(t.id)===Number(this.moduleType)):[]},currentCategory(){return this.currentModule.categories?this.currentModule.categories.find(t=>Number(t.id)===Number(this.category)):[]},currentSubject(){return Number(this.category)===33||Number(this.category)===38?63:Number(this.category)===35||Number(this.category)===39?62:this.userClasses[0].id}},props:["moduleType","category"],methods:{awardCommendation(){const e={date:new Date,categoryId:Number(this.category),moduleTypeId:Number(this.moduleType),teacherId:this.userDetails.isamsId,description:this.description,subjectId:this.currentSubject};console.log("awarding commendation: to ",this.selectedStudent,e),q.postAward(this.awardSuccess,this.$errorFn,this.selectedStudent,e)},awardSuccess(e){this.$q.notify({position:"center",message:"successfully awarded",color:"green"})},onReset(){this.selectedStudent=null,this.photo=null,this.description=null,this.$refs.awardForm.resetValidation()},awardFail(){this.$q.notify({position:"center",color:"red",message:"awarding failed, check your connection to the internet"})},filterFn(e,t,i){if(e.length<2){i();return}t(()=>{const m=e.toLowerCase();this.studentOptions=this.fullStudentOptions.filter(o=>o.label.toLowerCase().indexOf(m)>-1)})},getStudentList(){this.studentsLoading=!0,q.getStudentList(this.processStudents)},processStudents(e){console.log("studentList: ",e),this.fullStudentOptions=e.map(t=>{const i=t.name+" - "+t.boardingHouseCode+" - year "+t.NCYear;return{value:t.misId,label:i}}),console.log(this.fullStudentOptions),this.studentsLoading=!1},getPhoto(){this.photo=null,this.photoLoading=!0,console.log("getting Photo"),q.getPhoto(this.processPhoto,this.selectedStudent)},processPhoto(e){this.photo=`data:image/jpeg;base64,${e}`,this.photoLoading=!1}},watch:{selectedStudent(e){e&&this.getPhoto()},currentModule(e){console.log("currentModule: ",e)}},created(){this.getStudentList(),this.currentModule.categories||this.$router.push("/")},mounted(){console.log("mounted moduleType = ",this.moduleType),this.moduleType==7&&(this.copyPopup=!0)}},Ce={key:0,class:"flex justify-center items-center column"},we={key:1},Se={class:"q-pa-md"},_e={class:"flex justify-center"},Pe={class:"flex justify-center"},ke={key:0,style:{height:"50vw"},class:"flex items-center"},qe={class:"flex justify-center"},Ne=g("div",null,"When you award a copy you must:",-1),De=g("ul",null,[g("li",null,"Send a copy of the work to the Master's PA."),g("li",null," Recommend a suitable book to be bought for the recipient of the copy to the Master's PA. ")],-1);function Me(e,t,i,m,o,n){return p(),y(fe,null,{default:c(()=>[n.currentCategory?(p(),w("div",Ce,[u(T,{class:"q-ma-md",color:n.currentModule.color,"text-color":"white",size:"xl",icon:n.currentModule.icon},{default:c(()=>[v(S(n.currentModule.label),1)]),_:1},8,["color","icon"]),n.currentCategory.name!=="Default Category"?(p(),y(T,{key:0,class:"q-ma-md",color:"blue-8","text-color":"white",size:"md",icon:n.currentCategory.icon},{default:c(()=>[v(S(n.currentCategory.name),1)]),_:1},8,["icon"])):b("",!0),n.currentCategory.name!=="Default Category"&&n.currentModule.id!==11?(p(),w("div",we,S(n.currentCategory.description),1)):b("",!0)])):b("",!0),u(ye,{ref:"awardForm",onReset:n.onReset},{default:c(()=>[g("div",Se,[u(R,{class:"q-my-md",label:"student name",modelValue:o.selectedStudent,"onUpdate:modelValue":t[0]||(t[0]=r=>o.selectedStudent=r),options:o.studentOptions,"use-input":"",onFilter:n.filterFn,"map-options":"","emit-value":"",loading:o.studentsLoading,rules:[r=>!!r||"student is required"]},null,8,["modelValue","options","onFilter","loading","rules"]),g("div",_e,[u(k,{class:"q-mb-md",label:"award multiple","full-width":"",color:"primary",rounded:"",to:`/award/${i.moduleType}/${i.category}/multiple`},null,8,["to"])]),g("div",Pe,[o.photoLoading?(p(),w("div",ke,[u(ge)])):b("",!0),o.photo?(p(),y(ae,{key:1,src:o.photo,width:"50%"},null,8,["src"])):b("",!0)]),u(le,{label:"description",modelValue:o.description,"onUpdate:modelValue":t[1]||(t[1]=r=>o.description=r),class:"q-pb-md",rules:[r=>!!r||"description is required"]},null,8,["modelValue","rules"]),g("div",qe,[i.moduleType==="11"?(p(),y(k,{key:0,label:"quick descriptions",onClick:t[2]||(t[2]=r=>o.openDescriptionPopup=!0),flat:"",class:"text-primary text-bold q-mb-md"})):b("",!0)]),u(k,{rounded:"",class:"full-width q-my-md q-pa-md",color:"primary",label:"Award",onClick:n.awardCommendation,disable:n.disableDueToValidation},null,8,["onClick","disable"])])]),_:1},8,["onReset"]),u(j,{modelValue:o.openDescriptionPopup,"onUpdate:modelValue":t[3]||(t[3]=r=>o.openDescriptionPopup=r)},{default:c(()=>[u(E,null,{default:c(()=>[u(_,null,{default:c(()=>[(p(!0),w(ie,null,se(o.quickDescriptions[0].descriptions,r=>(p(),y(ce,{key:r},{default:c(()=>[ne((p(),y(de,{clickable:"",onClick:P=>o.description=r},{default:c(()=>[v(S(r),1)]),_:2},1032,["onClick"])),[[be]])]),_:2},1024))),128))]),_:1}),u(_,{class:"text-secondary"},{default:c(()=>[v(" To suggest other quick descriptions for this list, email cjw. ")]),_:1})]),_:1})]),_:1},8,["modelValue"]),u(j,{modelValue:o.copyPopup,"onUpdate:modelValue":t[4]||(t[4]=r=>o.copyPopup=r)},{default:c(()=>[u(E,null,{default:c(()=>[u(_,{class:"text-primary text-bold text-h5"},{default:c(()=>[v(" Awarding a copy ")]),_:1}),u(_,null,{default:c(()=>[Ne,De]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Re=re(xe,[["render",Me]]);export{Re as default};
