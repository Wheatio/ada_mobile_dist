import{Q as A}from"./QMenu.9c0ae8ce.js";import{Q as E}from"./QSelect.9981794d.js";import{k as n,h as O,aq as R,ar as U,r as z,a3 as G,B as K,C as H,p as J,l as W,t as Y,af as X,A as T,n as Z,x as $,_ as ee,o as m,I as g,w as u,c as w,d as l,J as b,K as S,e as y,a as h,Q as k,M as te,F as oe,$ as re}from"./index.0835d3cd.js";import{Q as se}from"./QImg.fe100920.js";import{Q as ie}from"./QInput.2669ef99.js";import{a as ne}from"./focus-manager.8e1b27e8.js";import{b as ae,a as le}from"./QItem.b5da8b2b.js";import{Q as B,a as P}from"./QCard.31e04df3.js";import{Q as j}from"./QDialog.88cddf69.js";import{Q as ue}from"./QPage.aea7938e.js";import{C as ce}from"./ClosePopup.8d7c1adc.js";import{a as q}from"./awardAPI.223c603e.js";import"./use-dark.e535c535.js";import"./selection.d17b1b0c.js";import"./focusout.fbc56a61.js";import"./use-tick.a35a1ec4.js";import"./use-timeout.275153e9.js";import"./use-key-composition.c69b71c6.js";import"./format.1c072718.js";import"./rtl.b51694b1.js";import"./use-prevent-scroll.f779b089.js";const de=[n("circle",{cx:"12.5",cy:"12.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"0s",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"12.5",cy:"52.5",r:"12.5","fill-opacity":".5"},[n("animate",{attributeName:"fill-opacity",begin:"100ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"52.5",cy:"12.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"300ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"52.5",cy:"52.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"600ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"92.5",cy:"12.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"800ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"92.5",cy:"52.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"400ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"12.5",cy:"92.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"700ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"52.5",cy:"92.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"500ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})]),n("circle",{cx:"92.5",cy:"92.5",r:"12.5"},[n("animate",{attributeName:"fill-opacity",begin:"200ms",dur:"1s",values:"1;.2;1",calcMode:"linear",repeatCount:"indefinite"})])];var me=O({name:"QSpinnerGrid",props:R,setup(e){const{cSize:t,classes:c}=U(e);return()=>n("svg",{class:c.value,fill:"currentColor",width:t.value,height:t.value,viewBox:"0 0 105 105",xmlns:"http://www.w3.org/2000/svg"},de)}}),fe=O({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:t,emit:c}){const v=Y(),o=z(null);let i=0;const r=[];function _(s){const p=typeof s=="boolean"?s:e.noErrorFocus!==!0,x=++i,V=(a,d)=>{c("validation"+(a===!0?"Success":"Error"),d)},F=a=>{const d=a.validate();return typeof d.then=="function"?d.then(f=>({valid:f,comp:a}),f=>({valid:!1,comp:a,err:f})):Promise.resolve({valid:d,comp:a})};return(e.greedy===!0?Promise.all(r.map(F)).then(a=>a.filter(d=>d.valid!==!0)):r.reduce((a,d)=>a.then(()=>F(d).then(f=>{if(f.valid===!1)return Promise.reject(f)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return x===i&&V(!0),!0;if(x===i){const{comp:d,err:f}=a[0];if(f!==void 0&&console.error(f),V(!1,d),p===!0){const I=a.find(({comp:L})=>typeof L.focus=="function"&&X(L.$)===!1);I!==void 0&&I.comp.focus()}}return!1})}function N(){i++,r.forEach(s=>{typeof s.resetValidation=="function"&&s.resetValidation()})}function D(s){s!==void 0&&T(s);const p=i+1;_().then(x=>{p===i&&x===!0&&(e.onSubmit!==void 0?c("submit",s):s!==void 0&&s.target!==void 0&&typeof s.target.submit=="function"&&s.target.submit())})}function M(s){s!==void 0&&T(s),c("reset"),Z(()=>{N(),e.autofocus===!0&&e.noResetFocus!==!0&&C()})}function C(){ne(()=>{if(o.value===null)return;const s=o.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||o.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||o.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(o.value.querySelectorAll("[tabindex]"),p=>p.tabIndex>-1);s!=null&&s.focus({preventScroll:!0})})}G($,{bindComponent(s){r.push(s)},unbindComponent(s){const p=r.indexOf(s);p>-1&&r.splice(p,1)}});let Q=!1;return K(()=>{Q=!0}),H(()=>{Q===!0&&e.autofocus===!0&&C()}),J(()=>{e.autofocus===!0&&C()}),Object.assign(v.proxy,{validate:_,resetValidation:N,submit:D,reset:M,focus:C,getValidationComponents:()=>r}),()=>n("form",{class:"q-form",ref:o,onSubmit:D,onReset:M},W(t.default))}}),pe={methods:{$errorFn(e){e?(console.log("ErrorFn says: ",e.response.data.exception[0].message),e.response.data.exception[0].message.includes("Department is configured as required")&&console.log("Department is configured as required")):console.error("no response received from server")}}};const he={mixins:[pe],data(){return{selectedStudent:"",description:null,studentOptions:null,reasonOptions:["Great effort",""],fullStudentOptions:[],studentList:["Adam","Becky","Charles","Dog","Esme"],photo:null,photoLoading:!1,openDescriptionPopup:!1,quickDescriptions:[{id:11,descriptions:["Late","Poor standard of uniform","Incomplete Prep","Prep not done","Disruptive behaviour","Not bringing necessary materials to the lesson"]}],studentsLoading:!0,copyPopup:!1}},computed:{disableDueToValidation(){return!(this.selectedStudent&&this.description)},userClasses(){return this.$store.getters["user/getUserClasses"]},userId(){return this.$store.getters["user/userId"]},userDetails(){return this.$store.getters["user/getUserDetails"]},awardCategories(){return this.$store.getters["awards/getAwardCategories"]},currentModule(){return this.awardCategories?this.awardCategories.find(t=>Number(t.id)===Number(this.moduleType)):[]},currentCategory(){return this.currentModule.categories?this.currentModule.categories.find(t=>Number(t.id)===Number(this.category)):[]},currentSubject(){return Number(this.category)===33||Number(this.category)===38?63:Number(this.category)===35||Number(this.category)===39?62:this.userClasses[0].id?this.userClasses[0].id:63}},props:["moduleType","category"],methods:{awardCommendation(){const e={date:new Date,categoryId:Number(this.category),moduleTypeId:Number(this.moduleType),teacherId:this.userDetails.isamsId,description:this.description,subjectId:this.currentSubject};console.log("awarding commendation: to ",this.selectedStudent,e),q.postAward(this.awardSuccess,this.$errorFn,this.selectedStudent,e)},awardSuccess(e){this.$q.notify({position:"center",message:"successfully awarded",color:"green"})},onReset(){this.selectedStudent=null,this.photo=null,this.description=null,this.$refs.awardForm.resetValidation()},awardFail(){this.$q.notify({position:"center",color:"red",message:"awarding failed, check your connection to the internet"})},filterFn(e,t,c){if(e.length<2){c();return}t(()=>{const v=e.toLowerCase();this.studentOptions=this.fullStudentOptions.filter(o=>o.label.toLowerCase().indexOf(v)>-1)})},getStudentList(){this.studentsLoading=!0,q.getStudentList(this.processStudents)},processStudents(e){console.log("studentList: ",e),this.fullStudentOptions=e.map(t=>{const c=t.name+" - "+t.boardingHouseCode+" - year "+t.NCYear;return{value:t.misId,label:c}}),console.log(this.fullStudentOptions),this.studentsLoading=!1},getPhoto(){this.photo=null,this.photoLoading=!0,console.log("getting Photo"),q.getPhoto(this.processPhoto,this.selectedStudent)},processPhoto(e){this.photo=`data:image/jpeg;base64,${e}`,this.photoLoading=!1}},watch:{selectedStudent(e){e&&this.getPhoto()},currentModule(e){console.log("currentModule: ",e)}},created(){this.getStudentList(),this.currentModule.categories||this.$router.push("/")},mounted(){console.log("mounted moduleType = ",this.moduleType),this.moduleType==7&&(this.copyPopup=!0)}},ge={key:0,class:"flex justify-center items-center column"},ye={key:1},be={class:"q-pa-md"},ve={class:"flex justify-center"},Ce={class:"flex justify-center"},xe={key:0,style:{height:"50vw"},class:"flex items-center"},we={class:"flex justify-center"},Se=h("div",null,"When you award a copy you must:",-1),Pe=h("ul",null,[h("li",null,"Send a copy of the work to the Master's PA."),h("li",null," Recommend a suitable book to be bought for the recipient of the copy to the Master's PA. ")],-1);function _e(e,t,c,v,o,i){return m(),g(ue,null,{default:u(()=>[i.currentCategory?(m(),w("div",ge,[l(A,{class:"q-ma-md",color:i.currentModule.color,"text-color":"white",size:"xl",icon:i.currentModule.icon},{default:u(()=>[b(S(i.currentModule.label),1)]),_:1},8,["color","icon"]),i.currentCategory.name!=="Default Category"?(m(),g(A,{key:0,class:"q-ma-md",color:"blue-8","text-color":"white",size:"md",icon:i.currentCategory.icon},{default:u(()=>[b(S(i.currentCategory.name),1)]),_:1},8,["icon"])):y("",!0),i.currentCategory.name!=="Default Category"&&i.currentModule.id!==11?(m(),w("div",ye,S(i.currentCategory.description),1)):y("",!0)])):y("",!0),l(fe,{ref:"awardForm",onReset:i.onReset},{default:u(()=>[h("div",be,[l(E,{class:"q-my-md",label:"student name",modelValue:o.selectedStudent,"onUpdate:modelValue":t[0]||(t[0]=r=>o.selectedStudent=r),options:o.studentOptions,"use-input":"",onFilter:i.filterFn,"map-options":"","emit-value":"",loading:o.studentsLoading,rules:[r=>!!r||"student is required"]},null,8,["modelValue","options","onFilter","loading","rules"]),h("div",ve,[l(k,{class:"q-mb-md",label:"award multiple","full-width":"",color:"primary",rounded:"",to:`/award/${c.moduleType}/${c.category}/multiple`},null,8,["to"])]),h("div",Ce,[o.photoLoading?(m(),w("div",xe,[l(me)])):y("",!0),o.photo?(m(),g(se,{key:1,src:o.photo,width:"50%"},null,8,["src"])):y("",!0)]),l(ie,{label:"description",modelValue:o.description,"onUpdate:modelValue":t[1]||(t[1]=r=>o.description=r),class:"q-pb-md",rules:[r=>!!r||"description is required"]},null,8,["modelValue","rules"]),h("div",we,[c.moduleType==="11"?(m(),g(k,{key:0,label:"quick descriptions",onClick:t[2]||(t[2]=r=>o.openDescriptionPopup=!0),flat:"",class:"text-primary text-bold q-mb-md"})):y("",!0)]),l(k,{rounded:"",class:"full-width q-my-md q-pa-md",color:"primary",label:"Award",onClick:i.awardCommendation,disable:i.disableDueToValidation},null,8,["onClick","disable"])])]),_:1},8,["onReset"]),l(j,{modelValue:o.openDescriptionPopup,"onUpdate:modelValue":t[3]||(t[3]=r=>o.openDescriptionPopup=r)},{default:u(()=>[l(B,null,{default:u(()=>[l(P,null,{default:u(()=>[(m(!0),w(oe,null,te(o.quickDescriptions[0].descriptions,r=>(m(),g(ae,{key:r},{default:u(()=>[re((m(),g(le,{clickable:"",onClick:_=>o.description=r},{default:u(()=>[b(S(r),1)]),_:2},1032,["onClick"])),[[ce]])]),_:2},1024))),128))]),_:1}),l(P,{class:"text-secondary"},{default:u(()=>[b(" To suggest other quick descriptions for this list, email cjw. ")]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(j,{modelValue:o.copyPopup,"onUpdate:modelValue":t[4]||(t[4]=r=>o.copyPopup=r)},{default:u(()=>[l(B,null,{default:u(()=>[l(P,{class:"text-primary text-bold text-h5"},{default:u(()=>[b(" Awarding a copy ")]),_:1}),l(P,null,{default:u(()=>[Se,Pe]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Je=ee(he,[["render",_e]]);export{Je as default};
